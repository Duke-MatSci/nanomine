WSGIPythonHome /apps/whyis/venv

<VirtualHost *>
    ProxyPass /nm/ http://localhost:3000/nm/
    ProxyPassReverse /nm/ http://localhost:3000/nm/
    ProxyPass /nm http://localhost:3000/nm/
    ProxyPassReverse /nm http://localhost:3000/nm/

    ProxyPass /nmr/ http://localhost:3000/
    ProxyPassReverse /nmr/ http://localhost:3000/
    ProxyPass /nmr http://localhost:3000/
    ProxyPassReverse /nmr http://localhost:3000/

    ProxyPass /nmf/ http://localhost:3000/files/
    ProxyPassReverse /nmf/ http://localhost:3000/files/
    ProxyPass /nmf http://localhost:3000/files/
    ProxyPassReverse /nmf http://localhost:3000/files/

    ProxyPass /nmstatic/ http://localhost:3000/nmstatic/
    ProxyPassReverse /nmstatic/ http://localhost:3000/nmstatic/
    ProxyPass /nmstatic http://localhost:3000/nmstatic/
    ProxyPassReverse /nmstatic http://localhost:3000/nmstatic/

    <Location /socket.io>
        # This is needed to handle the websocket transport through the proxy, since
        # etherpad does not use a specific sub-folder, such as /ws/ to handle this kind of traffic.
        # Taken from https://github.com/ether/etherpad-lite/issues/2318#issuecomment-63548542
        # Thanks to beaugunderson for the semantics
        RewriteEngine On
        RewriteCond %{QUERY_STRING} transport=websocket    [NC]
        RewriteRule /(.*) ws://localhost:3000/nmr/socket.io/$1 [P,L]
        ProxyPass http://localhost:3000/nmr/socket.io retry=0 timeout=30
        ProxyPassReverse http://localhost:3000/nmr/socket.io
    </Location>

    #definition for /api needs to come before / to make /api visible. Otherwise / overrides
    WSGIDaemonProcess pyserver user=whyis group=whyis threads=5 request-timeout=1200 home=/apps/nanomine/pyserver
    WSGIScriptAlias /api /apps/nanomine/pyserver/pyserver.wsgi

    <Directory /apps/nanomine/pyserver>
      WSGIProcessGroup pyserver
      WSGIApplicationGroup %{GLOBAL}
      Order deny,allow
      Allow from all
      Require all granted
    </Directory>

    #ServerName hbgd.tw.rpi.edu
    #<IfDefine IgnoreThisForNow>
    WSGIDaemonProcess whyis user=whyis group=whyis threads=5 request-timeout=1200 home=/apps/whyis
    WSGIScriptAlias / /apps/whyis/wsgi.py

    <Directory /apps/whyis>
        WSGIProcessGroup whyis
        WSGIApplicationGroup %{GLOBAL}
        <IfVersion < 2.3 >
            Order allow,deny
            Allow from all
        </IfVersion>
        <IfVersion >= 2.3>
            Require all granted
        </IfVersion>
        <IfModule mod_headers.c>
            Header set Access-Control-Allow-Origin "*"
        </IfModule>
    </Directory>
    #</IfDefine>
</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
